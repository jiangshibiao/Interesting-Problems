## 趣题摘记

> 记录遇到的有趣的题。主要是数学和算法问题。

## 一个简单游走问题

- 初始时你在数轴的位置 $0$ 处。每单位时间你能向左或者向右走一格。
- 问第一次走到 $1$ 的期望步数。
- 解法一：
    + 设 $f_i$ 表示正好向右走了 $i$ 步的期望。得 $f_i=\frac{1}{2}(f_{i-1}+f_{i+1})+1$ 且 $f_0=0$，联立化简后得 $f_i = 2f_{i-1}-f_{i-2}-2(i \geq 2)$。继续化简得 $f_i=(3i-4)f_1-(i-1)i$。
    + 我们要求的是 $f_1$。假设 $f_1=x$，则 $f_n=(3n-4)x-(n-1)n$，当 $n \rightarrow +\infty$ 时 $f_n \rightarrow -\infty$，显然矛盾。所以 $f_1=+\infty$
- 上述做法太麻烦了。解法二：
    + 设 $f_1$ 表示正好向右走了一步的期望。注意期望是有可加性的，所以$f_1=\frac{1}{2}(0+2f_1)+1$，化简得 $f_1=f_1+1$。显然 $f_1=+\infty$。

## 一个概率构造问题

- 一个函数 $f()$ 会以 $p$ 的概率返回 $1$，以 $1-p$ 的概率返回0。
- 要构造一个函数 $g()$，以正好 $0.5$ 的概率返回 $0$ 和 $1$。
- 注意：$p$ 是一个固定但是未知的概率。
- 解法一：
    - 连续调用两次 $f()$，显然返回 $01$ 和 $10$ 的概率相同，我们可以根据这个来决定 $g()$ 的返回，如果返回值相同，就继续这么操作。显然，当 $p \rightarrow 0/1$ 时，这个的期望步数趋于无穷大。
- 解法二（改进）：
    - 我们可以设计算法使期望步数进一步下降。
    - 对于询问序列的一个前缀长度 $n$，一旦 $C_n^m$ 是偶数（$m$ 是返回的 $1$ 的个数），其实我们就能立即结束并得到返回值（总能分成两半）。
    - 如何决定返回什么呢？每次看当前01序列和它的回文哪个字典序小，一样就递归一半，复杂度是 $O(N)$ 的。
    -  [知乎](https://www.zhihu.com/question/304075115) 上有更详细讨论。

## 一个概率构造和计算问题

- 有 $100$ 个人被编号为 $1 \sim 100$，对应他们编号的 $100$ 个号码牌被打乱顺序放在了$100$ 个抽屉里。每个人可以打开至多半数的抽屉，并从中找出对应自己编号的号码牌。只有所有人都找到了自己的号码牌，任务才算成功（所有人会依次独立地操作，彼此不能交流，操作完后所有抽屉都会复原）。**假设抽屉的各种放置状态出现的概率均等**，设计一种固定的策略，所有人都成功的概率尽可能的大。
- 成功的概率比直觉上要高很多。
- 策略：**首先打开自己号码的抽屉，如果没中，继续打开抽屉里号码牌对应的抽屉……重复50次。**。
- 分析：
    + 显然，所有人都能找到自己，当且仅当所有圆环的长度不超过 $50$。
    + 下面就是要计算，对于一个随机排列，置换环长度全都不超过 $50$ 的概率是多少。
    + 容斥。从 $100$ 个数中选出 $m(> 50)$ 个数构成大环（剩下的随便排）的方案数是：$C_{100}^m \cdot (m-1)! \cdot (100-m)!$
    + 所以最终答案为 $P=1-\sum \limits_{m=51}^{100} \frac{1}{m}$。且当 $n \rightarrow \infty$ 时，$P \rightarrow 1-\ln{2}$

## BP 算法

- 描述
    + 已知联合分布函数 $F(x_1,x_2,...x_n)$ （可以设 $x_i=0,1$ 来简化思考），求每个 $x_i$ 的边缘分布函数。
    + 一般认为联合分布函数比较“稀疏”，可以用一张无向图（因子图, factor graph）来描述（点是变量，边是两个变量之间的条件概率函数，设为 $\Phi_{i,j}$）。
    + 例子：一个五个变量的因子图以及信息的传递。
    ![](0801-1.png)
- 转化
    + 一般认为，可以从物理角度去解析某个概率分布的构型。具体地，设上述图的能量为：
        ![](0801-2.png)
    + 这样，某构型 $E=\{x_1,x_2...x_n\}$ 出现的概率是 $\frac{1}{normalize} e^{-E}$
    + 不是很懂实际的物理意义，我将这部分转化理解为：将求边缘分布函数 $f(p)$ 的累乘通过取 $\log$ 转化为累加。
    + 取完对数后，比如我们要求的 $P(x_1)$ 就可以表示为：
         ![](0801-3.png)
- 迭代过程
    + 迭代其实就是把上述式子不断累加求出来的过程。
    + 定义点 $i \rightarrow j$ 的 `message` 为：
        ![](0801-4.png)
    + 很显然，上述式子是一个迭代的过程。且易得 $P(x_i) = \prod \limits_{j \in N(i)} m_{ji}(x_i)$

## 一个简单抛硬币问题

- 抛一枚质地均匀的硬币。问期望多少次抛出连续两个向上。
- 解法：这一类期望问题都不宜直接在序列上计算，可以直接根据概率的意义计算。设 $f_i$ 表示连续抛出 $i$ 个向上的期望抛硬币次数。显然 $f_1=2,f_i=f_{i-1}+1+\frac{1}{2}f_i$，化简得 $f_i=2f_{i-1}+2$，原问题里 $f_2=6$。

## 一道CCPC2019的题

- 比完后再更